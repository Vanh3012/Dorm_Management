{% extends "student/student_base.html" %}
{% block content %}

<div class="bg-white shadow rounded p-6">
    <h2 class="text-2xl font-bold mb-4 text-red-600">Th√¥ng tin ph√≤ng {{ room.room_number }}</h2>

    <!-- B·ªë c·ª•c 2 c·ªôt -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
        <!-- Th√¥ng tin ph√≤ng (tr√°i) -->
        <div class="space-y-2 text-gray-700">
            <p><b>C∆° s·ªü:</b> {{ room.address }}</p>
            <p><b>Khu:</b> {{ room.block }}</p>
            <p><b>S·ª©c ch·ª©a:</b> {{ room.capacity }}</p>
            <p><b>ƒêang ·ªü:</b> {{ room.capacity - room.available }}/{{ room.capacity }}</p>
            <p><b>Gi√° ph√≤ng:</b> {{ "{:,.0f}".format(room.price_room) }} ƒë/th√°ng</p>
            <p><b>ƒêi·ªán:</b> {{ "{:,.0f}".format(room.price_electricity) }} ƒë/kWh</p>
            <p><b>N∆∞·ªõc:</b> {{ "{:,.0f}".format(room.price_water) }} ƒë/m¬≥</p>
            <p><b>D·ªãch v·ª• kh√°c:</b> {{ "{:,.0f}".format(room.price_service) }} ƒë</p>
            <p><b>Ti·ªÅn c·ªçc:</b> {{ "{:,.0f}".format(room.deposit) }} ƒë</p>
            <p><b>Tr·∫°ng th√°i:</b> {{ room.status }}</p>

            <div class="mt-6">
                {% if room.available > 0 %}
                <!-- N√∫t m·ªü modal -->
                <button onclick="openModal()" class="bg-red-600 hover:bg-red-700 text-white px-5 py-2 rounded">
                    üìù ƒêƒÉng k√Ω ph√≤ng
                </button>
                {% else %}
                <button class="bg-gray-400 text-white px-5 py-2 rounded cursor-not-allowed" disabled>
                    H·∫øt ch·ªó - Kh√¥ng th·ªÉ ƒëƒÉng k√Ω
                </button>
                {% endif %}
            </div>
        </div>

        <!-- Slider ·∫£nh (ph·∫£i) -->
        {% if room.images and room.images|length > 0 %}
        <div id="roomSlider" class="relative w-full rounded-lg overflow-hidden shadow">
            {% for img in room.images %}
            <img src="{{ img.image_url }}"
                class="slide w-full h-[360px] object-cover {% if not loop.first %}hidden{% endif %}">
            {% endfor %}

            <!-- N√∫t ƒëi·ªÅu h∆∞·ªõng -->
            <button id="prevBtn"
                class="absolute left-3 top-1/2 -translate-y-1/2 bg-black/40 text-white w-9 h-9 rounded-full hover:bg-black/60">‚Äπ</button>
            <button id="nextBtn"
                class="absolute right-3 top-1/2 -translate-y-1/2 bg-black/40 text-white w-9 h-9 rounded-full hover:bg-black/60">‚Ä∫</button>

            <!-- Dots -->
            <div class="absolute bottom-3 w-full flex justify-center gap-2">
                {% for _ in room.images %}
                <span
                    class="dot w-2.5 h-2.5 rounded-full {% if loop.first %}bg-white{% else %}bg-white/40{% endif %}"></span>
                {% endfor %}
            </div>
        </div>
        {% else %}
        <p class="italic text-gray-500">Ch∆∞a c√≥ ·∫£nh cho ph√≤ng n√†y</p>
        {% endif %}
    </div>
</div>

<!-- Modal ƒëƒÉng k√Ω -->
<div id="registerModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 z-50 overflow-y-auto">
    <!-- Wrapper ƒë·ªÉ cƒÉn gi·ªØa modal -->
    <div class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white w-full max-w-3xl rounded-lg shadow-lg p-6 relative max-h-[90vh] overflow-y-auto">
        <h3 class="text-xl font-bold mb-6 text-center text-red-600"> ƒê∆°n ƒëƒÉng k√Ω ph√≤ng {{ room.room_number }}</h3>

        <form action="{{ url_for('student.register_room', room_id=room.id) }}" method="POST"
            enctype="multipart/form-data" class="space-y-6">

            <!-- Th√¥ng tin c√° nh√¢n -->
            <fieldset class="border rounded-lg p-4">
                <legend class="px-2 text-sm font-semibold text-gray-700">Th√¥ng tin c√° nh√¢n</legend>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                    <div>
                        <label class="block text-sm font-medium">H·ªç v√† t√™n</label>
                        <input type="text" name="fullname" value="{{ user.fullname }}" required
                            class="w-full border px-3 py-2 rounded focus:ring-2 focus:ring-red-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium">MSSV</label>
                        <input type="text" name="student_id" value="{{ user.student_id }}" required
                            class="w-full border px-3 py-2 rounded focus:ring-2 focus:ring-red-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium">L·ªõp</label>
                        <input type="text" name="class_id" value="{{ user.class_id }}" required
                            class="w-full border px-3 py-2 rounded focus:ring-2 focus:ring-red-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium">CCCD</label>
                        <input type="text" name="citizen_id" value="{{ user.citizen_id }}" required
                            class="w-full border px-3 py-2 rounded focus:ring-2 focus:ring-red-500">
                    </div>
                </div>
            </fieldset>

            <!-- Th√¥ng tin li√™n h·ªá -->
            <fieldset class="border rounded-lg p-4">
                <legend class="px-2 text-sm font-semibold text-gray-700">Th√¥ng tin li√™n h·ªá</legend>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                    <div>
                        <label class="block text-sm font-medium">Email</label>
                        <input type="email" name="email" value="{{ user.email }}" required
                            class="w-full border px-3 py-2 rounded focus:ring-2 focus:ring-red-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium">S·ªë ƒëi·ªán tho·∫°i</label>
                        <input type="text" name="phone_number" value="{{ user.phone_number }}" required
                            class="w-full border px-3 py-2 rounded focus:ring-2 focus:ring-red-500">
                    </div>
                </div>
            </fieldset>

            <!-- ƒê·ªãa ch·ªâ / qu√™ qu√°n -->
            <fieldset class="border rounded-lg p-4">
                <legend class="px-2 text-sm font-semibold text-gray-700">ƒê·ªãa ch·ªâ & Qu√™ qu√°n</legend>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                    <div>
                        <label class="block text-sm font-medium">ƒê·ªãa ch·ªâ th∆∞·ªùng tr√∫</label>
                        <input type="text" name="address" class="w-full border px-3 py-2 rounded">
                    </div>
                </div>
            </fieldset>

            <!-- Ng∆∞·ªùi th√¢n -->
            <fieldset class="border rounded-lg p-4">
                <legend class="px-2 text-sm font-semibold text-gray-700">Th√¥ng tin ng∆∞·ªùi th√¢n</legend>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-2">
                    <div>
                        <label class="block text-sm font-medium">Ng∆∞·ªùi th√¢n 1 - H·ªç t√™n</label>
                        <input type="text" name="relative1_name" class="w-full border px-3 py-2 rounded">
                    </div>
                    <div>
                        <label class="block text-sm font-medium">SƒêT NT1</label>
                        <input type="text" name="relative1_phone" class="w-full border px-3 py-2 rounded">
                    </div>
                    <div>
                        <label class="block text-sm font-medium">NƒÉm sinh NT1</label>
                        <input type="text" name="relative1_birthyear" class="w-full border px-3 py-2 rounded">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                    <div>
                        <label class="block text-sm font-medium">Ng∆∞·ªùi th√¢n 2 - H·ªç t√™n</label>
                        <input type="text" name="relative2_name" class="w-full border px-3 py-2 rounded">
                    </div>
                    <div>
                        <label class="block text-sm font-medium">SƒêT NT2</label>
                        <input type="text" name="relative2_phone" class="w-full border px-3 py-2 rounded">
                    </div>
                    <div>
                        <label class="block text-sm font-medium">NƒÉm sinh NT2</label>
                        <input type="text" name="relative2_birthyear" class="w-full border px-3 py-2 rounded">
                    </div>
                </div>
            </fieldset>

            <!-- Ch√≠nh s√°ch / kh√≥ khƒÉn -->
            <fieldset class="border rounded-lg p-4">
                <legend class="px-2 text-sm font-semibold text-gray-700">Ch√≠nh s√°ch / Ho√†n c·∫£nh</legend>
                <div class="space-y-3 mt-2">
                    <div>
                        <label class="block text-sm font-medium">Thu·ªôc di·ªán ch√≠nh s√°ch, x√£ h·ªôi</label>
                        <input type="text" name="policy_type" placeholder="VD: Con li·ªát sƒ©, h·ªô ngh√®o..."
                            class="w-full border px-3 py-2 rounded">
                    </div>
                    <div>
                        <label class="block text-sm font-medium">Ho√†n c·∫£nh gia ƒë√¨nh kh√≥ khƒÉn</label>
                        <textarea name="family_income" rows="3"
                            placeholder="M√¥ t·∫£ thu nh·∫≠p gia ƒë√¨nh, ƒë·∫•t ƒëai, t∆∞ li·ªáu s·∫£n xu·∫•t..."
                            class="w-full border px-3 py-2 rounded"></textarea>
                    </div>
                </div>
            </fieldset>

            <!-- Upload -->
            <fieldset class="border rounded-lg p-4">
                <legend class="px-2 text-sm font-semibold text-gray-700">Upload h·ªì s∆°</legend>
                <div class="space-y-3 mt-2">
                    <div>
                        <label class="block text-sm font-medium">·∫¢nh 3x4</label>
                        <input type="file" name="student_photo" accept="image/*" class="w-full">
                    </div>
                    <div>
                        <label class="block text-sm font-medium">·∫¢nh CCCD</label>
                        <input type="file" name="citizen_proof" accept="image/*" class="w-full">
                    </div>
                    <div>
                        <label class="block text-sm font-medium">Minh ch·ª©ng ∆∞u ti√™n (n·∫øu c√≥)</label>
                        <input type="file" name="priority_proof" accept="image/*" class="w-full">
                    </div>
                </div>
            </fieldset>

            <!-- Buttons -->
            <div class="flex justify-end gap-3">
                <button type="button" onclick="closeModal()"
                    class="px-4 py-2 rounded bg-gray-400 text-white hover:bg-gray-500">H·ªßy</button>
                <button type="submit" class="px-4 py-2 rounded bg-red-600 text-white hover:bg-red-700">G·ª≠i ƒë∆°n ƒëƒÉng
                    k√Ω</button>
            </div>
        </form>

        <button onclick="closeModal()"
            class="absolute top-3 right-3 text-gray-500 hover:text-gray-700 text-xl">‚úï</button>
    </div>
</div>

        <!-- N√∫t ƒë√≥ng -->
        <button onclick="closeModal()"
            class="absolute top-3 right-3 text-gray-500 hover:text-gray-700 text-xl">‚úï</button>
    </div>
    </div>
</div>

<!-- JS modal + slider -->
<script>
    function openModal() {
        document.getElementById("registerModal").classList.remove("hidden");
    }
    function closeModal() {
        document.getElementById("registerModal").classList.add("hidden");
    }

    (() => {
        const root = document.getElementById('roomSlider');
        if (!root) return;
        const slides = Array.from(root.querySelectorAll('.slide'));
        const dots = Array.from(root.querySelectorAll('.dot'));
        const prev = root.querySelector('#prevBtn');
        const next = root.querySelector('#nextBtn');
        let i = 0;

        const show = (n) => {
            slides.forEach((el, idx) => el.classList.toggle('hidden', idx !== n));
            dots.forEach((d, idx) => d.className = 'dot w-2.5 h-2.5 rounded-full ' +
                (idx === n ? 'bg-white' : 'bg-white/40'));
            i = n;
        };

        prev?.addEventListener('click', () => show((i - 1 + slides.length) % slides.length));
        next?.addEventListener('click', () => show((i + 1) % slides.length));
        dots.forEach((d, idx) => d.addEventListener('click', () => show(idx)));

        if (slides.length > 1) setInterval(() => show((i + 1) % slides.length), 5000);
    })();
</script>

{% endblock %}