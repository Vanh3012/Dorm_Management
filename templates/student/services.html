{% extends "student_base.html" %}
{% block content %}

<div class="p-6 space-y-6">
    <h1 class="text-2xl font-bold">Đăng ký dịch vụ</h1>

    <!-- Form đăng ký -->
    <form method="POST" class="bg-white shadow rounded-lg p-6">
        <div class="mb-4">
            <label for="service_type" class="block font-medium">Loại dịch vụ</label>
            <select name="service_type" id="service_type" onchange="showDefaultDesc()"
                class="w-full border px-3 py-2 rounded focus:ring-2 focus:ring-blue-400" required>
                <option value="trash">Thu gom rác</option>
                <option value="maintenance">Bảo trì sửa chữa</option>
            </select>
            <p id="defaultDesc" class="mt-2 text-gray-600 italic"></p>
        </div>

        <div class="mb-4">
            <label for="description" class="block font-medium">Mô tả chi tiết</label>
            <textarea name="description" id="description"
                class="w-full border px-3 py-2 rounded focus:ring-2 focus:ring-blue-400"
                placeholder="Ví dụ: Vòi nước hỏng, ổ điện chập..."></textarea>
        </div>

        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
            Gửi yêu cầu
        </button>
    </form>

    <!-- Lịch sử yêu cầu -->
    <div class="bg-white shadow rounded-lg p-6">
        <h2 class="text-xl font-semibold mb-4">Lịch sử yêu cầu</h2>
        <table class="w-full border text-sm text-center">
            <thead class="bg-gray-100 text-gray-700 uppercase text-xs">
                <tr>
                    <th class="px-4 py-2">ID</th>
                    <th class="px-4 py-2">Dịch vụ</th>
                    <th class="px-4 py-2">Mô tả thêm</th>
                    <th class="px-4 py-2">Giá tiền</th>
                    <th class="px-4 py-2">Trạng thái</th>
                    <th class="px-4 py-2">Ngày</th>
                </tr>
            </thead>
            <tbody>
                {% for req in service_requests %}
                <tr class="border-b hover:bg-gray-50">
                    <td class="px-4 py-2 font-medium">{{ req.id }}</td>
                    <td class="px-4 py-2">
                        {% if req.service_type == "trash" %} Thu gom rác
                        {% elif req.service_type == "maintenance" %} Bảo trì sửa chữa
                        {% endif %}
                    </td>
                    <td class="px-4 py-2 text-left">{{ req.description or "-" }}</td>
                    <td class="px-4 py-2 font-semibold">
                        {% if req.service_type == "maintenance" %}
                        {% if req.price and req.price > 0 %}
                        {{ "{:,.0f}".format(req.price) }}đ
                        {% else %}
                        <span class="italic text-gray-500">Sẽ báo sau</span>
                        {% endif %}
                        {% else %}
                        {{ "{:,.0f}".format(req.price) }}đ
                        {% endif %}
                    </td>
                    <td class="px-4 py-2">
                        {% if req.status == "pending" %}
                        <span class="px-2 py-1 rounded text-xs font-semibold bg-yellow-100 text-yellow-800">Chờ xử
                            lý</span>
                        {% elif req.status == "in_progress" %}
                        <span class="px-2 py-1 rounded text-xs font-semibold bg-blue-100 text-blue-800">Đang xử
                            lý</span>
                        {% elif req.status == "completed" %}
                        <span class="px-2 py-1 rounded text-xs font-semibold bg-green-100 text-green-800">Hoàn
                            thành</span>
                        {% elif req.status == "rejected" %}
                        <span class="px-2 py-1 rounded text-xs font-semibold bg-red-100 text-red-800">Từ chối</span>
                        {% endif %}
                    </td>
                    <td class="px-4 py-2">{{ req.created_at.strftime("%d/%m/%Y %H:%M") }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" class="px-4 py-4 italic text-gray-500">Chưa có yêu cầu nào</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    const defaultDescriptions = {
        trash: "Thu gom rác hàng ngày. Phí: 50.000đ / tháng",
        maintenance: "Sửa chữa, bảo trì thiết bị trong phòng. Phí tùy tình trạng, sẽ thông báo sau"
    };

    function showDefaultDesc() {
        const sel = document.getElementById("service_type");
        const desc = defaultDescriptions[sel.value];
        document.getElementById("defaultDesc").innerText = desc;
    }

    window.onload = showDefaultDesc;
</script>

{% endblock %}